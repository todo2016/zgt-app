{"version":3,"file":"request.js","sources":["utils/request.js"],"sourcesContent":["// 统一请求封装\r\nimport { getToken, removeToken } from './auth'\r\n\r\n// 基础配置\r\nconst baseConfig = {\r\n  baseURL: 'http://localhost:8080/api', // 开发环境API地址\r\n  timeout: 10000,\r\n  header: {\r\n    'Content-Type': 'application/json'\r\n  }\r\n}\r\n\r\n// 请求拦截器\r\nconst requestInterceptor = (config) => {\r\n  // 添加token\r\n  const token = getToken()\r\n  if (token) {\r\n    config.header.Authorization = `Bearer ${token}`\r\n  }\r\n  \r\n  // 显示loading\r\n  uni.showLoading({\r\n    title: '加载中...',\r\n    mask: true\r\n  })\r\n  \r\n  return config\r\n}\r\n\r\n// 响应拦截器\r\nconst responseInterceptor = (response) => {\r\n  // 隐藏loading\r\n  uni.hideLoading()\r\n  \r\n  const { statusCode, data } = response\r\n  \r\n  if (statusCode === 200) {\r\n    // 业务状态码处理\r\n    if (data.code === 0) {\r\n      return data.data\r\n    } else if (data.code === 401) {\r\n      // token过期，清除本地token并跳转登录\r\n      removeToken()\r\n      uni.reLaunch({\r\n        url: '/pages/login/login'\r\n      })\r\n      uni.showToast({\r\n        title: '登录已过期，请重新登录',\r\n        icon: 'none'\r\n      })\r\n      return Promise.reject(new Error(data.message))\r\n    } else {\r\n      // 其他业务错误\r\n      uni.showToast({\r\n        title: data.message || '请求失败',\r\n        icon: 'none'\r\n      })\r\n      return Promise.reject(new Error(data.message))\r\n    }\r\n  } else {\r\n    // HTTP状态码错误\r\n    uni.showToast({\r\n      title: '网络请求失败',\r\n      icon: 'none'\r\n    })\r\n    return Promise.reject(new Error('网络请求失败'))\r\n  }\r\n}\r\n\r\n// 错误处理\r\nconst errorHandler = (error) => {\r\n  uni.hideLoading()\r\n  uni.showToast({\r\n    title: error.message || '请求失败',\r\n    icon: 'none'\r\n  })\r\n  return Promise.reject(error)\r\n}\r\n\r\n// 统一请求方法\r\nexport const request = (options) => {\r\n  const config = {\r\n    ...baseConfig,\r\n    ...options,\r\n    url: baseConfig.baseURL + options.url\r\n  }\r\n  \r\n  // 应用请求拦截器\r\n  const interceptedConfig = requestInterceptor(config)\r\n  \r\n  return new Promise((resolve, reject) => {\r\n    uni.request({\r\n      ...interceptedConfig,\r\n      success: (response) => {\r\n        try {\r\n          const result = responseInterceptor(response)\r\n          resolve(result)\r\n        } catch (error) {\r\n          reject(error)\r\n        }\r\n      },\r\n      fail: (error) => {\r\n        errorHandler(error)\r\n        reject(error)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\n// 常用请求方法\r\nexport const get = (url, params = {}) => {\r\n  return request({\r\n    url,\r\n    method: 'GET',\r\n    data: params\r\n  })\r\n}\r\n\r\nexport const post = (url, data = {}) => {\r\n  return request({\r\n    url,\r\n    method: 'POST',\r\n    data\r\n  })\r\n}\r\n\r\nexport const put = (url, data = {}) => {\r\n  return request({\r\n    url,\r\n    method: 'PUT',\r\n    data\r\n  })\r\n}\r\n\r\nexport const del = (url, params = {}) => {\r\n  return request({\r\n    url,\r\n    method: 'DELETE',\r\n    data: params\r\n  })\r\n}\r\n"],"names":["getToken","uni","removeToken"],"mappings":";;;AAIA,MAAM,aAAa;AAAA,EACjB,SAAS;AAAA;AAAA,EACT,SAAS;AAAA,EACT,QAAQ;AAAA,IACN,gBAAgB;AAAA,EACjB;AACH;AAGA,MAAM,qBAAqB,CAAC,WAAW;AAErC,QAAM,QAAQA,WAAAA,SAAU;AACxB,MAAI,OAAO;AACT,WAAO,OAAO,gBAAgB,UAAU,KAAK;AAAA,EAC9C;AAGDC,gBAAAA,MAAI,YAAY;AAAA,IACd,OAAO;AAAA,IACP,MAAM;AAAA,EACV,CAAG;AAED,SAAO;AACT;AAGA,MAAM,sBAAsB,CAAC,aAAa;AAExCA,gBAAAA,MAAI,YAAa;AAEjB,QAAM,EAAE,YAAY,KAAI,IAAK;AAE7B,MAAI,eAAe,KAAK;AAEtB,QAAI,KAAK,SAAS,GAAG;AACnB,aAAO,KAAK;AAAA,IAClB,WAAe,KAAK,SAAS,KAAK;AAE5BC,6BAAa;AACbD,oBAAAA,MAAI,SAAS;AAAA,QACX,KAAK;AAAA,MACb,CAAO;AACDA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO;AAAA,QACP,MAAM;AAAA,MACd,CAAO;AACD,aAAO,QAAQ,OAAO,IAAI,MAAM,KAAK,OAAO,CAAC;AAAA,IACnD,OAAW;AAELA,oBAAAA,MAAI,UAAU;AAAA,QACZ,OAAO,KAAK,WAAW;AAAA,QACvB,MAAM;AAAA,MACd,CAAO;AACD,aAAO,QAAQ,OAAO,IAAI,MAAM,KAAK,OAAO,CAAC;AAAA,IAC9C;AAAA,EACL,OAAS;AAELA,kBAAAA,MAAI,UAAU;AAAA,MACZ,OAAO;AAAA,MACP,MAAM;AAAA,IACZ,CAAK;AACD,WAAO,QAAQ,OAAO,IAAI,MAAM,QAAQ,CAAC;AAAA,EAC1C;AACH;AAGA,MAAM,eAAe,CAAC,UAAU;AAC9BA,gBAAAA,MAAI,YAAa;AACjBA,gBAAAA,MAAI,UAAU;AAAA,IACZ,OAAO,MAAM,WAAW;AAAA,IACxB,MAAM;AAAA,EACV,CAAG;AACD,SAAO,QAAQ,OAAO,KAAK;AAC7B;AAGO,MAAM,UAAU,CAAC,YAAY;AAClC,QAAM,SAAS;AAAA,IACb,GAAG;AAAA,IACH,GAAG;AAAA,IACH,KAAK,WAAW,UAAU,QAAQ;AAAA,EACnC;AAGD,QAAM,oBAAoB,mBAAmB,MAAM;AAEnD,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACtCA,kBAAAA,MAAI,QAAQ;AAAA,MACV,GAAG;AAAA,MACH,SAAS,CAAC,aAAa;AACrB,YAAI;AACF,gBAAM,SAAS,oBAAoB,QAAQ;AAC3C,kBAAQ,MAAM;AAAA,QACf,SAAQ,OAAO;AACd,iBAAO,KAAK;AAAA,QACb;AAAA,MACF;AAAA,MACD,MAAM,CAAC,UAAU;AACf,qBAAa,KAAK;AAClB,eAAO,KAAK;AAAA,MACb;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;AAGY,MAAC,MAAM,CAAC,KAAK,SAAS,OAAO;AACvC,SAAO,QAAQ;AAAA,IACb;AAAA,IACA,QAAQ;AAAA,IACR,MAAM;AAAA,EACV,CAAG;AACH;AAEY,MAAC,OAAO,CAAC,KAAK,OAAO,OAAO;AACtC,SAAO,QAAQ;AAAA,IACb;AAAA,IACA,QAAQ;AAAA,IACR;AAAA,EACJ,CAAG;AACH;;;"}